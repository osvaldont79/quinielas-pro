<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quinielas-Pro ‚Ä¢ Jornada 17</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {font-family:Arial,sans-serif;background:linear-gradient(135deg,#0d1b2a,#1b263b,#415a77);color:#fff;margin:0;padding:15px;}
    .contenedor {max-width:850px;margin:0 auto;background:rgba(0,0,0,0.7);border-radius:20px;padding:30px;box-shadow:0 15px 50px rgba(0,0,0,0.9);}
    h1 {text-align:center;font-size:3.2em;color:#ffd700;text-shadow:0 0 15px gold;}
    .sub {text-align:center;font-size:1.6em;color:#ffeb3b;margin:15px 0 25px;}
    input,select {width:100%;padding:16px;margin:10px 0;border-radius:12px;border:none;font-size:18px;}
    .partido {background:#fff;color:#000;margin:18px 0;padding:20px;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,0.5);}
    .partido label {font-weight:bold;font-size:1.4em;text-align:center;display:block;margin-bottom:15px;color:#1e3c72;}
    .botones {display:flex;justify-content:center;gap:30px;}
    .botones button {width:110px;height:85px;font-size:32px;font-weight:bold;border:none;border-radius:18px;cursor:pointer;}
    
    /* COLORES NUEVOS */
    .local {background:#2e7d32;color:white;}     /* Verde */
    .empate {background:#f57c00;color:white;}    /* Naranja */
    .visita {background:#1565c0;color:white;}   /* AZUL OSCURO (Visitante) */
    
    .seleccionado {transform:scale(1.25);box-shadow:0 0 30px gold;}
    .botones-flex {display:flex;gap:15px;margin-top:40px;}
    .btn-generar,.btn-form {flex:1;padding:20px;font-size:22px;font-weight:bold;border:none;border-radius:50px;cursor:pointer;}
    .btn-generar {background:#ffd700;color:#000;}
    .btn-form {background:#4285F4;color:white;display:flex;align-items:center;justify-content:center;gap:10px;}
    .btn-form img {width:32px;}
    .ok {color:#4caf50;text-align:center;font-size:20px;margin-top:20px;font-weight:bold;}
    
    /* Panel admin OCULTO para los usuarios normales */
    #panel-admin {display:none;}
    
    /* Solo visible para admin con par√°metro secreto */
    body.admin-visible #panel-admin {
      display:block;
      background:#000;
      padding:20px;
      border-radius:15px;
      margin-top:40px;
    }
    
    #tabla-general {width:100%;border-collapse:collapse;margin-top:15px;}
    #tabla-general th,#tabla-general td {border:1px solid #ffd700;padding:8px;text-align:center;font-size:13px;}
    #tabla-general th {background:#ffd700;color:#000;}
    .pagado {background:#1b5e20;color:white;}
    .nopagado {background:#c62828;color:white;}
    .btn-exportar {background:#2196F3;color:white;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;margin:5px;}
    .btn-limpiar-admin {background:#c62828;color:white;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;margin:5px;}
    
    /* Enlace admin discreto */
    .enlace-admin {
      text-align:center;
      margin-top:20px;
      font-size:14px;
    }
    .enlace-admin a {
      color:#9c27b0;
      text-decoration:none;
      font-weight:bold;
      cursor:pointer;
    }
    .enlace-admin a:hover {
      text-decoration:underline;
    }
  </style>
</head>
<body>

<div class="contenedor">
  <h1>QUINIELAS-PRO</h1>
  <p class="sub">Jornada 17 ‚Ä¢ Apertura 2025</p>

  <div class="instrucciones" style="background:#1e3c72;padding:15px;border-radius:10px;margin-bottom:20px;">
    <h3 style="color:#ffd700;text-align:center;">üìã INSTRUCCIONES:</h3>
    <ol style="margin-left:20px;">
      <li>Selecciona tus pron√≥sticos para los 14 partidos</li>
      <li>Descarga tu PDF con "DESCARGAR PDF"</li>
      <li>Haz clic en "ENVIAR POR GOOGLE FORM" para registrar tus datos</li>
      <li>Completa el formulario con tus datos personales</li>
    </ol>
  </div>

  <input type="text" id="nombre" placeholder="Nombre completo (aparecer√° en el PDF)">
  <input type="text" id="telefono" placeholder="WhatsApp (aparecer√° en el PDF)">
  <select id="pago">
    <option value="">¬øYa depositaste los $300?</option>
    <option value="si">S√≠, ya pagu√©</option>
    <option value="no">No, pago esta semana</option>
  </select>

  <!-- 14 PARTIDOS -->
  <div class="partido"><label>1. Tigres vs Am√©rica</label><div class="botones"><button class="local" onclick="marcar(this,1)">L</button><button class="empate" onclick="marcar(this,1)">E</button><button class="visita" onclick="marcar(this,1)">V</button><input type="hidden" id="res1"></div></div>
  <div class="partido"><label>2. Cruz Azul vs Monterrey</label><div class="botones"><button class="local" onclick="marcar(this,2)">L</button><button class="empate" onclick="marcar(this,2)">E</button><button class="visita" onclick="marcar(this,2)">V</button><input type="hidden" id="res2"></div></div>
  <div class="partido"><label>3. Chivas vs Toluca</label><div class="botones"><button class="local" onclick="marcar(this,3)">L</button><button class="empate" onclick="marcar(this,3)">E</button><button class="visita" onclick="marcar(this,3)">V</button><input type="hidden" id="res3"></div></div>
  <div class="partido"><label>4. Pumas vs Pachuca</label><div class="botones"><button class="local" onclick="marcar(this,4)">L</button><button class="empate" onclick="marcar(this,4)">E</button><button class="visita" onclick="marcar(this,4)">V</button><input type="hidden" id="res4"></div></div>
  <div class="partido"><label>5. Atlas vs Le√≥n</label><div class="botones"><button class="local" onclick="marcar(this,5)">L</button><button class="empate" onclick="marcar(this,5)">E</button><button class="visita" onclick="marcar(this,5)">V</button><input type="hidden" id="res5"></div></div>
  <div class="partido"><label>6. Santos vs Tijuana</label><div class="botones"><button class="local" onclick="marcar(this,6)">L</button><button class="empate" onclick="marcar(this,6)">E</button><button class="visita" onclick="marcar(this,6)">V</button><input type="hidden" id="res6"></div></div>
  <div class="partido"><label>7. Necaxa vs Quer√©taro</label><div class="botones"><button class="local" onclick="marcar(this,7)">L</button><button class="empate" onclick="marcar(this,7)">E</button><button class="visita" onclick="marcar(this,7)">V</button><input type="hidden" id="res7"></div></div>
  <div class="partido"><label>8. Mazatl√°n vs Puebla</label><div class="botones"><button class="local" onclick="marcar(this,8)">L</button><button class="empate" onclick="marcar(this,8)">E</button><button class="visita" onclick="marcar(this,8)">V</button><input type="hidden" id="res8"></div></div>
  <div class="partido"><label>9. San Luis vs Ju√°rez</label><div class="botones"><button class="local" onclick="marcar(this,9)">L</button><button class="empate" onclick="marcar(this,9)">E</button><button class="visita" onclick="marcar(this,9)">V</button><input type="hidden" id="res9"></div></div>
  <div class="partido"><label>10. Necaxa vs Guadalajara</label><div class="botones"><button class="local" onclick="marcar(this,10)">L</button><button class="empate" onclick="marcar(this,10)">E</button><button class="visita" onclick="marcar(this,10)">V</button><input type="hidden" id="res10"></div></div>
  <div class="partido"><label>11. Le√≥n vs Cruz Azul</label><div class="botones"><button class="local" onclick="marcar(this,11)">L</button><button class="empate" onclick="marcar(this,11)">E</button><button class="visita" onclick="marcar(this,11)">V</button><input type="hidden" id="res11"></div></div>
  <div class="partido"><label>12. Monterrey vs Tigres</label><div class="botones"><button class="local" onclick="marcar(this,12)">L</button><button class="empate" onclick="marcar(this,12)">E</button><button class="visita" onclick="marcar(this,12)">V</button><input type="hidden" id="res12"></div></div>
  <div class="partido"><label>13. Am√©rica vs Pumas</label><div class="botones"><button class="local" onclick="marcar(this,13)">L</button><button class="empate" onclick="marcar(this,13)">E</button><button class="visita" onclick="marcar(this,13)">V</button><input type="hidden" id="res13"></div></div>
  <div class="partido"><label>14. Toluca vs Atlas</label><div class="botones"><button class="local" onclick="marcar(this,14)">L</button><button class="empate" onclick="marcar(this,14)">E</button><button class="visita" onclick="marcar(this,14)">V</button><input type="hidden" id="res14"></div></div>

  <div class="botones-flex">
    <button class="btn-generar" onclick="generarPDF()">DESCARGAR PDF</button>
    <button class="btn-form" onclick="abrirFormulario()">
      <img src="https://www.gstatic.com/images/icons/material/system/2x/post_google_forms_black_24dp.png" alt="Google Forms">
      ENVIAR POR GOOGLE FORM
    </button>
  </div>

  <div class="ok" id="ok"></div>
  
  <!-- Enlace discreto para admin -->
  <div class="enlace-admin">
    <a onclick="mostrarPanelAdmin()">Acceso administrador</a>
  </div>
</div>

<!-- PANEL ADMIN (OCULTO para usuarios normales) -->
<div id="panel-admin">
  <h2 style="color:#ffd700;text-align:center;">PANEL ADMIN - TABLA GENERAL</h2>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
    <div>
      <p style="margin:0;">Total: <span id="total">0</span> | Pagaron: <span id="pagados">0</span> | Pendientes: <span id="pendientes">0</span></p>
    </div>
    <div>
      <button class="btn-exportar" onclick="exportarExcel()">EXPORTAR EXCEL</button>
      <button class="btn-exportar" onclick="exportarPDFAdmin()">EXPORTAR PDF</button>
      <button class="btn-exportar" onclick="abrirGoogleSheets()">VER GOOGLE SHEETS</button>
      <button class="btn-limpiar-admin" onclick="ocultarPanelAdmin()">OCULTAR PANEL</button>
    </div>
  </div>
  <table id="tabla-general">
    <thead>
      <tr>
        <th>#</th><th>Nombre</th><th>Tel</th><th>Pago</th>
        <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th>
        <th>10</th><th>11</th><th>12</th><th>13</th><th>14</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ============ CONFIGURACI√ìN ============
// TU GOOGLE FORM
const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeTI01jufWRnawTwxTcWUhJsyhvOICP4fMIHATYuxZccmfm7Q/viewform';

// TU ID DE GOOGLE SHEETS (YA CONFIGURADO)
const GOOGLE_SHEETS_ID = '1aDgBFXekNpyg_scA7rX3WSNInYY-JbwzLimlUmbNlB4';

// Clave secreta para admin (C√ÅMBIALA por una que solo t√∫ sepas)
const CLAVE_SECRETA = "admin2025";

// ============ FUNCIONES PRINCIPALES ============

function marcar(btn, num) {
  const grupo = btn.parentNode.querySelectorAll("button");
  grupo.forEach(b => b.classList.remove("seleccionado"));
  btn.classList.add("seleccionado");
  document.getElementById("res" + num).value = btn.innerText;
}

function abrirFormulario() {
  // Validar que haya seleccionado al menos algunos partidos
  let seleccionados = 0;
  for (let i = 1; i <= 14; i++) {
    if (document.getElementById("res" + i).value) {
      seleccionados++;
    }
  }
  
  if (seleccionados === 0) {
    if (!confirm("No has seleccionado ning√∫n pron√≥stico. ¬øDeseas abrir el formulario de todos modos?")) {
      return;
    }
  }
  
  // Abrir Google Form
  window.open(GOOGLE_FORM_URL, '_blank');
  
  // Mostrar mensaje
  document.getElementById("ok").innerHTML = "‚úÖ Formulario abierto. Completa tus datos ah√≠.<br>Los datos se guardar√°n autom√°ticamente en Google Sheets.";
  document.getElementById("ok").style.color = "#4caf50";
}

function generarPDF() {
  const nombre = document.getElementById("nombre").value.trim();
  const tel = document.getElementById("telefono").value.trim();
  const pago = document.getElementById("pago").value;

  if (!nombre || !tel || !pago) {
    alert("Por favor, llena todos los datos antes de generar el PDF");
    return;
  }

  const pronos = [];
  let faltan = false;
  for (let i=1; i<=14; i++) {
    const v = document.getElementById("res"+i).value;
    if (!v) faltan = true;
    pronos.push(v || "-");
  }
  
  if (faltan) {
    if (!confirm("Faltan algunos pron√≥sticos. ¬øDeseas generar el PDF de todos modos? (Los partidos sin seleccionar aparecer√°n como '-')")) {
      return;
    }
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'mm', 'a4');

  // FORMATO ESPEC√çFICO PARA QUE EL ADMIN PUEDA LEERLO F√ÅCILMENTE
  
  // T√≠tulo principal - usando el formato exacto que busca el admin
  doc.setFontSize(28);
  doc.setTextColor(255, 215, 0);
  doc.text("QUINIELAS-PRO - JORNADA", 105, 20, {align: "center"});
  
  // Nombre - en el formato exacto "Nombre: [nombre]"
  doc.setFontSize(16);
  doc.setTextColor(0, 0, 0);
  doc.text("Nombre: " + nombre, 20, 35);
  
  // WhatsApp - en el formato exacto "WhatsApp: [n√∫mero]"
  doc.text("WhatsApp: " + tel, 20, 45);
  
  // Pago - usando el texto exacto que busca el admin
  doc.text("Pago: " + (pago === "si" ? "PAGADO" : "PENDIENTE"), 20, 55);
  
  // Fecha - en el formato que aparece en el PDF original
  doc.text("Fecha: " + new Date().toLocaleString("es-MX", {
    day: 'numeric',
    month: 'numeric',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  }), 20, 65);
  
  // LISTA DE PARTIDOS CON EL FORMATO ESPEC√çFICO
  doc.setFontSize(12);
  let y = 80;
  
  const partidos = [
    "1 . T i g r e s   v s   A m √© r i c a",
    "2 . C r u z   A z u l   v s   M o n t e r r e y",
    "3 . C h i v a s   v s   T o l u c a",
    "4 . P u m a s   v s   P a c h u c a",
    "5 . A t l a s   v s   L e √≥ n",
    "6 . S a n t o s   v s   T i j u a n a",
    "7 . N e c a x a   v s   Q u e r √© t a r o",
    "8 . M a z a t l √° n   v s   P u e b l a",
    "9 . S a n   L u i s   v s   J u √° r e z",
    "10 . N e c a x a   v s   G u a d a l a j a r a",
    "11 . L e √≥ n   v s   C r u z   A z u l",
    "12 . M o n t e r r e y   v s   T i g r e s",
    "13 . A m √© r i c a   v s   P u m a s",
    "14 . T o l u c a   v s   A t l a s"
  ];
  
  // Agregar cada partido con el pron√≥stico en el formato exacto
  for (let i = 0; i < partidos.length; i++) {
    const pronostico = pronos[i];
    
    // Formato exacto: "1 . T i g r e s   v s   A m √© r i c a !' L"
    const textoLinea = partidos[i] + "   !'   " + pronostico;
    doc.text(textoLinea, 20, y);
    
    y += 10;
    
    // Si nos quedamos sin espacio, agregar nueva p√°gina
    if (y > 270 && i < partidos.length - 1) {
      doc.addPage();
      y = 20;
    }
  }
  
  // Nombre del archivo usando el nombre del participante
  doc.save(nombre.replace(/[^a-zA-Z0-9]/g, "_") + "_J17.pdf");
  document.getElementById("ok").innerHTML = "üìÑ PDF generado y descargado";
  document.getElementById("ok").style.color = "#ffd700";
}

// ============ FUNCIONES ADMIN ============

function verificarParametroSecreto() {
  const urlParams = new URLSearchParams(window.location.search);
  const clave = urlParams.get('clave');
  
  if (clave === CLAVE_SECRETA) {
    document.body.classList.add('admin-visible');
    actualizarTabla();
  }
}

async function mostrarPanelAdmin() {
  const claveIngresada = prompt("Ingresa la clave de administrador:");
  
  if (claveIngresada === CLAVE_SECRETA) {
    document.body.classList.add('admin-visible');
    await actualizarTabla();
    // Agregar clave a la URL
    const nuevaURL = window.location.origin + window.location.pathname + '?clave=' + CLAVE_SECRETA;
    window.history.pushState({}, '', nuevaURL);
    // Desplazar al panel admin
    document.getElementById("panel-admin").scrollIntoView({behavior: 'smooth'});
  } else {
    alert("Clave incorrecta");
  }
}

function ocultarPanelAdmin() {
  document.body.classList.remove('admin-visible');
  window.history.pushState({}, '', window.location.pathname);
}

// Cargar al iniciar
document.addEventListener('DOMContentLoaded', function() {
  verificarParametroSecreto();
});

// Funci√≥n para leer datos de Google Sheets
async function leerDeGoogleSheets() {
  try {
    // Usar la API de Sheets para leer datos p√∫blicos
    const csvUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/export?format=csv`;
    
    const response = await fetch(csvUrl);
    if (!response.ok) {
      throw new Error(`Error ${response.status}: ${response.statusText}`);
    }
    
    const csvText = await response.text();
    
    // Parsear CSV
    const lines = csvText.split('\n').filter(line => line.trim() !== '');
    const participantes = [];
    
    // Saltar encabezados (primera l√≠nea) y procesar datos
    for (let i = 1; i < lines.length; i++) {
      const line = lines[i];
      // Manejar comas dentro de campos entre comillas
      const cells = [];
      let currentCell = '';
      let insideQuotes = false;
      
      for (let j = 0; j < line.length; j++) {
        const char = line[j];
        if (char === '"') {
          insideQuotes = !insideQuotes;
        } else if (char === ',' && !insideQuotes) {
          cells.push(currentCell.trim());
          currentCell = '';
        } else {
          currentCell += char;
        }
      }
      cells.push(currentCell.trim()); // √öltima celda
      
      if (cells.length >= 18) { // Debe tener al menos 18 columnas
        // Determinar estado de pago
        let estadoPago = 'no';
        const pagoText = cells[3] || ''; // Columna D
        if (pagoText.toLowerCase().includes('s√≠') || 
            pagoText.toLowerCase().includes('si') || 
            pagoText.toLowerCase().includes('yes') ||
            pagoText.toLowerCase().includes('pagado') ||
            pagoText === '1') {
          estadoPago = 'si';
        }
        
        // Obtener pron√≥sticos (columnas E a R)
        const pronosticos = [];
        for (let k = 4; k < 18; k++) {
          const pron = cells[k] || '-';
          // Solo tomar la primera letra si hay texto adicional
          pronosticos.push(pron.charAt(0).toUpperCase() || '-');
        }
        
        participantes.push({
          nombre: cells[1] || 'Sin nombre', // Columna B
          tel: cells[2] || 'Sin tel√©fono',  // Columna C
          pago: estadoPago,
          pronosticos: pronosticos,
          fecha: cells[0] || new Date().toLocaleString() // Columna A (timestamp)
        });
      }
    }
    
    return participantes;
  } catch (error) {
    console.error('Error leyendo Google Sheets:', error);
    
    // Si hay error de CORS, usar un proxy alternativo
    try {
      const proxyUrl = `https://corsproxy.io/?https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/export?format=csv`;
      const response = await fetch(proxyUrl);
      const csvText = await response.text();
      
      // Parsear como antes...
      const lines = csvText.split('\n').filter(line => line.trim() !== '');
      const participantes = [];
      
      for (let i = 1; i < lines.length; i++) {
        const cells = lines[i].split(',');
        if (cells.length >= 3) {
          participantes.push({
            nombre: cells[1] || '',
            tel: cells[2] || '',
            pago: (cells[3] || '').toLowerCase().includes('s√≠') ? 'si' : 'no',
            pronosticos: cells.slice(4, 18).map(p => p.trim().charAt(0).toUpperCase() || '-'),
            fecha: cells[0] || ''
          });
        }
      }
      
      return participantes;
    } catch (proxyError) {
      console.error('Error con proxy:', proxyError);
      return [];
    }
  }
}

async function actualizarTabla() {
  const okElement = document.getElementById("ok");
  okElement.innerHTML = "üîÑ Cargando datos de Google Sheets...";
  okElement.style.color = "#ffd700";
  
  try {
    const participantes = await leerDeGoogleSheets();
    
    const tbody = document.querySelector("#tabla-general tbody");
    tbody.innerHTML = "";
    
    if (participantes.length === 0) {
      tbody.innerHTML = `<tr><td colspan="20" style="text-align:center;padding:20px;">
        <p>üìä No hay datos a√∫n en Google Sheets.</p>
        <p>Los participantes aparecer√°n aqu√≠ cuando llenen el formulario.</p>
        <p><a href="${GOOGLE_FORM_URL}" target="_blank" style="color:#4caf50;">Ver formulario</a> | 
        <a href="https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/edit" target="_blank" style="color:#4285F4;">Ver Google Sheets</a></p>
      </td></tr>`;
    } else {
      participantes.forEach((p,i) => {
        let row = `<tr>
          <td>${i+1}</td>
          <td>${p.nombre}</td>
          <td>${p.tel}</td>
          <td class="${p.pago==='si'?'pagado':'nopagado'}">${p.pago==='si'?'PAGADO':'NO PAG√ì'}</td>`;
        
        // Mostrar los 14 pron√≥sticos
        for (let j = 0; j < 14; j++) {
          const pron = p.pronosticos && p.pronosticos[j] ? p.pronosticos[j] : '-';
          row += `<td><strong>${pron}</strong></td>`;
        }
        
        row += `<td>${p.fecha}</td></tr>`;
        tbody.innerHTML += row;
      });
    }
    
    const total = participantes.length;
    const pagados = participantes.filter(p => p.pago === "si").length;
    const pendientes = total - pagados;
    
    document.getElementById("total").textContent = total;
    document.getElementById("pagados").textContent = pagados;
    document.getElementById("pendientes").textContent = pendientes;
    
    okElement.innerHTML = `‚úÖ ${total} participantes cargados desde Google Sheets`;
    okElement.style.color = "#4caf50";
    
  } catch (error) {
    okElement.innerHTML = "‚ùå Error cargando datos. Verifica la configuraci√≥n de Google Sheets.";
    okElement.style.color = "#f44336";
    console.error('Error actualizando tabla:', error);
  }
}

function exportarExcel() {
  // Exportar desde Google Sheets
  window.open(`https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/export?format=xlsx`, '_blank');
}

function abrirGoogleSheets() {
  window.open(`https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/edit`, '_blank');
}

function exportarPDFAdmin() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l', 'mm', 'a4');
  
  doc.setFontSize(16);
  doc.text("TABLA GENERAL - QUINIELAS PRO - JORNADA 17", 150, 15, {align: "center"});
  doc.setFontSize(10);
  
  // Leer datos y generar PDF
  leerDeGoogleSheets().then(participantes => {
    if (participantes.length === 0) {
      doc.text("No hay datos disponibles", 150, 40, {align: "center"});
      doc.save("tabla_general_quinielas_vacia.pdf");
      return;
    }
    
    const headers = ["#", "Nombre", "Tel", "Pago", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "Fecha"];
    let x = 10;
    
    headers.forEach((header, i) => {
      doc.text(header, x, 35);
      x += i === 1 ? 40 : i === 2 ? 20 : i === 18 ? 30 : 10;
    });
    
    doc.line(10, 38, 287, 38);
    
    let y = 45;
    participantes.forEach((p, i) => {
      if (y > 190) {
        doc.addPage();
        y = 20;
        x = 10;
        headers.forEach((header, idx) => {
          doc.text(header, x, y+5);
          x += idx === 1 ? 40 : idx === 2 ? 20 : idx === 18 ? 30 : 10;
        });
        doc.line(10, y+8, 287, y+8);
        y += 15;
      }
      
      x = 10;
      doc.text((i+1).toString(), x, y);
      x += 10;
      doc.text(p.nombre.substring(0, 20), x, y);
      x += 40;
      doc.text(p.tel, x, y);
      x += 20;
      doc.text(p.pago === 'si' ? 'PAGADO' : 'NO PAG√ì', x, y);
      x += 10;
      
      // Mostrar los 14 pron√≥sticos
      for (let j = 0; j < 14; j++) {
        const pron = p.pronosticos && p.pronosticos[j] ? p.pronosticos[j] : '-';
        doc.text(pron, x, y);
        x += 10;
      }
      
      doc.text(p.fecha.substring(0, 16), x, y);
      
      y += 8;
    });
    
    doc.save("tabla_general_quinielas_" + new Date().toISOString().slice(0,10) + ".pdf");
  }).catch(error => {
    console.error('Error generando PDF:', error);
    alert("Error al generar PDF. Verifica tu conexi√≥n.");
  });
}

// Funci√≥n para recargar datos manualmente
function recargarDatos() {
  actualizarTabla();
}
</script>
</body>
</html>